<?xml version="1.0" encoding="UTF-8"?>
<Module>
    <ModulePrefs title="Test API Calendar" height="400" title_url="http://www.risevision.com/help/users/what-are-gadgets/free-gadgets/rise-vision-clock/">
    <Require feature="rpc" />
    <Optional feature="rise-api">
        <Param name="reports_ready" />
    </Optional>
    </ModulePrefs>
    <UserPref name="id" display_name="ID" default_value="" datatype="hidden" />
    <UserPref name="showTime" display_name="Show Time?" datatype="bool" default_value="true" />
    <UserPref name="timeFormat" display_name="Time Format" datatype="enum" default_value="12hTime">
    <EnumValue value="12hTime" display_value="12-hour"/>
    <EnumValue value="24hTime" display_value="24-hour"/>
    </UserPref>
    <UserPref name="showDate" display_name="Show Date?" datatype="bool" default_value="true" />
    <UserPref name="dateFormat" display_name="Date Format" datatype="enum" default_value="longDate">
    <EnumValue value="shortDate" display_value="mm/dd/yyyy"/>
    <EnumValue value="europeanDate" display_value="dd/mm/yyyy"/>
    <EnumValue value="mediumDate" display_value="mmm dd yyyy"/>
    <EnumValue value="longDate" display_value="Month dd, yyyy"/>
    </UserPref>
    <UserPref name="text_font-style" display_name="Font" datatype="string" default_value=".text_font-style{font-family:Verdana, Verdana, Geneva, sans-serif;color:rgb(0, 0, 0);font-size:20px;}"/>
    <UserPref name="backgroundColor" display_name="Background Color" default_value="" datatype="string"/>
    <UserPref name="rsH" display_name="Container Height" default_value="100%" datatype="hidden"/>
    <UserPref name="rsW" display_name="Container Width" default_value="100%" datatype="hidden"/>
    <UserPref name="rsS" display_name="Scale" default_value="100" datatype="hidden"/>
    <UserPref name="rsA" display_name="Alignment" default_value="mc" datatype="hidden"/>
    <Content type="html">
    <![CDATA[
    <style type="text/css">
        body, div {
        background: transparent;
        text-align: center;
        
        /* user can't select text on a touchscreen */
        user-select: none;
        -moz-user-select: none;
        -webkit-user-select: none;
        -khtml-user-select: none; 
        }

       __UP_text_font-style__
     </style>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript">
        
        var prefs = new gadgets.Prefs();
        
        //Issue 1041 - Disable right-click.
        window.oncontextmenu = function() {
        return false;
        };
        
        //Add Analytics code.
        var _gaq = _gaq || [];
        
        _gaq.push(['_setAccount', 'UA-41395348-14']);
        _gaq.push(['_trackPageview']);
      
        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
        
        function play() {
        
        }
        
        function pause() {
        
        }
        
        function stop() {
        
        }
        
        function readyEvent() {
        gadgets.rpc.call('', 'rsevent_ready', null, prefs.getString("id"), true, true, true, true, true);
        }
        
        function doneEvent() {
        gadgets.rpc.call('', 'rsevent_done', null, prefs.getString("id"));
        }
        
        function initClock() {
        var id = prefs.getString("id");
        var backgroundColor = prefs.getString("backgroundColor");
     
        // register your RPC calls (communicate with the viewer application) 
        // each one of these is a command. the Viewer will send this command, and the function
        // in the command will be called. For example the first one, once rscmd_play_ + id is called, the play();
        // function is called 
        if (id !== null && id != "") {
            gadgets.rpc.register("rscmd_play_" + id, play);
            gadgets.rpc.register("rscmd_pause_" + id, pause);
            gadgets.rpc.register("rscmd_stop_" + id, stop);
        } 
     
        if (backgroundColor !== null && backgroundColor != "") {
            document.body.style.background = backgroundColor;
        } 
     
        clock();
        readyEvent();
        }
        
        function clock() {
            var backgroundColor = prefs.getString("backgroundColor");
            var hoje = new Date();
            var ultimo_dia = new Date(hoje.getFullYear(), hoje.getMonth()+2, 0);

            var inicio = ultimo_dia.getFullYear()+""+("00"+(ultimo_dia.getMonth()+1)).slice(-2)+""+"01";
            var fim = ultimo_dia.getFullYear()+""+("00"+(ultimo_dia.getMonth()+1)).slice(-2)+""+ultimo_dia.getDate();
            var dates = inicio+"%2F"+fim;            

            var key = "AIzaSyBcVaj4FrVL2bm5ZZ0dsZJtiDD-_ac-_lM";
            var url = "https://www.googleapis.com/calendar/v3/calendars/ls65k1pj4n8m6pudancii5d35s%40group.calendar.google.com/events?key="+key;

            $.getJSON( url, function( data ) {
                var items = [];
                items.push("<h2> " + data.summary + "</h2>");
                items.push("<h4> " + data.description + "</h4>");

                $.each( data.items, function( key, val ) {

                    items.push( "<li id='" + key + "'>" + ($.isEmptyObject(val.start.dateTime) ? val.start.date : val.start.dateTime)  + ": " + val.summary +  "</li>" );

                    /*for(valores in val){
                        items.push( "<li id='" + key + "'>" + valores + ": " + valores[val] +  "</li>" );
                    }
                    */
                });

                $( "<ul/>", {
                    "class": "my-new-list",
                    html: items.join( "" )
                }).appendTo( "#eventos" );

            });

            document.getElementById("eventos").innerHTML = "chegou!";
            setTimeout("clock()", 300000);
        }
        
        gadgets.util.registerOnLoadHandler(initClock); 
    </script>
         
    <div id="eventos" class="text_font-style" style="height:100%;width:100%;">
    </div>
    ]]>
    </Content>
</Module>